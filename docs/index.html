<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Sudokupad penpa+ importer 0.1.0</title>
		<meta name="author" content="Mark Langezaal, MarkTekfan#8907">
		<meta name="copyright"content="Mark Langezaal">
		<!-- <meta name="url" content="https://app.crackingthecryptic.com"> -->
		<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no, minimal-ui" />
		<meta name="HandheldFriendly" content="true" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABXFBMVEX////aGk0daJs8fakaZpnhOmfcIVRFg67+/f5nmLvjRG7cI1XbHlDnaovkRnAuc6LhPGjdJ1g0d6Ynb6DgNmP7/P3++vvw9fj3zdhUjrQ5e6gjbZ4gap3qfZrfMmD2+fv+9vj98/XM3emxy92Ut9DztMTwnbNEgq1AgKswdaQqcqHob4/iQWveLl3n7/T87/Pj7PPd6PD75+zC1uS40OD40tyiwdWZutKCrMh/qcd8qMZtnr/xo7ddkrdOiLBIhrChh6iqep7mZYflVXviT3fiS3Tq8PX64uj63+bF2Oanxdn2yNT2xNGHpMHzrsBwn8Dyrb95lribl7Xuk6zukartj6jMiaZFeqaEgKVifKXuiaNveKHNgaBHc6B7dp5Sb53peZbnd5aOa5ReZJLcb5HpcJCiZ4+yZo2eYYukXojcYIW1WIHLWIC9T3rRR3LVQm3lPmrSPGnTM2LXMF5v7Cm9AAABh0lEQVQ4y72S51PCQBDFs5dLciQxjQBSBRGRZu+CdHvvvfde/v8ZwUkAB/KNcb/97r3budt9VJtrvpOQkUFrfUPQ9zI4tmhp8EPOi73uKSvdWYDzqAfHpxzNWihEkRUeUsfYzsmYGyGUa65R7y3rkQIIUkDI0zjGeZFtXLOHGwxKQBIgqYC6HezqsWO6D2E5467rRAHQeVG8Ha5S/zrycWfvpbzT1IfcXyqvQqnTPOiexa8sA+Uxg6ezTzroa6Te0hF+YRmRTRg4g0+fH1f/fquDZRRp1wDXJKKRrdlwNFBDupWBr8E/GBxLWiuDkDYn1UPLTYbLh6tv8Btgi/todGjO0ZxlfFO6MGhUwzS6FhPDptw/U9mGZ/+jdsd1EJXvFFB3glUy9xkN1TvyN5/VNAATISTswVolEZzMNQZGFPwSpCQVilvoN1MTWt9k46PGFihnOgVMJRT3Hhwbd1CDQ83BHEiwYpJ5Q26XZeyLAqgnaJqyqkgAkrmsb4KyrOXeYNdoN6HaWj9O3CwsngKXCwAAAABJRU5ErkJggg==" />
		<style>
			body { background-color: #121212; } /* Avoid flash-of-white */
		</style>
		<link rel="stylesheet" href="./style.css">
	</head>
	<body>

		<script src="./fpuzzlesdecoder.js"></script>
		<script src="./penpa-style.js"></script>
		<script src="./penpa-puzzle.js"></script>
		<script src="./penpa-drawingcontext.js"></script>
		<script src="./penpa-tools.js"></script>
		<script src="./penpa-decoder.js"></script>
		<script src="./penpa-number.js"></script>
		<script src="./penpa-symbol.js"></script>

		<div class="app">

			<div class="topbar">
				<div class="menu">
					<button class="appmenu" id="appmenubtn"></button>
				</div>
				<img src="./images/sudokupad_square_logo.png"> <span>&nbsp;&nbsp;&nbsp;</span>
				<span>SudokuPad Penpa+ Puzzle Importer</span>
			</div>
			<div class="penpa">
				<div">
					<div>
						<div>Penpa+ puzzle url:</div>
						<textarea rows="10" cols="120" id="penpa-url" placeholder="https://" oninput="textOnChange()"></textarea>
					</div>
					<button id="importbtn" onclick="openInSudokupad()">Open in SudokuPad</button>
					<label id="disclaimer">(Beta version, for testing purposes only)</label>
					<div id="errortext"> </div>
					<div class="footer2">
						Created by <a href="https://discordapp.com/users/MarkTekfan#8907" target="_blank">Mark Langezaal</a> and <a href="https://svencodes.com" target="_blank">Sven Neumann</a> (&copy; 2022-2023) | 
						&nbsp;Please support Sven on <a href="https://patreon.svencodes.com/" target="_blank">Patreon</a>!
					</div>
					<svg id="dummysvg" class="boardsvg" xmlns="http://www.w3.org/2000/svg" version="1.1" draggable="false" style="vector-effect: non-scaling-stroke;"></svg>

				</div>
			</div>
		</div>
		<script defer src="./utilities.js"></script>
		<script defer src="./puzzleloader.js"></script>
		<script defer src="./puzzlezipper.js"></script>
		<script defer src="./lzipper.js"></script>
		<script defer src="./zlib.js"></script>
		<script defer>			
			window.addEventListener('DOMContentLoaded', () => {
				let urltext = document.querySelector('#penpa-url')
				urltext.focus();
			});

			function textOnChange(event) {
				let errortext = document.querySelector('#errortext');
				errortext.innerHTML = '';
			}

			function openInSudokupad(event)
			{
				let urltext = document.querySelector('#penpa-url')
				let url = urltext.value;
				let param = url.substring(url.indexOf('&') + 1);
				if (param.length === 0)
					return;

				Promise.resolve(param)
				.then(penpa => loadPenpaPuzzle(penpa))
				.then(res => loadFPuzzle.compressPuzzle(res))
				.then(ctc => {				
					var redirect = 'https://alpha.sudokupad.app/ctc' + ctc;
					console.log(redirect, redirect.length);
					window.open(redirect, '_blank');
				})
				.catch(err => {
					console.error('Unable to convert penpa puzzle');
					console.log(err);
					let errortext = document.querySelector('#errortext');
					if (err.penpa) {
						errortext.innerHTML = err.penpa;
					}
					else {
						errortext.innerHTML = 'An error occured while processing the penpa url.<br>'
					}
				});
			}
		</script>

	</body>
</html>